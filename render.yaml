databases:
  - name: job-board-db
    databaseName: jobboard
    user: jobboard_user

services:
  - type: web
    name: job-board-backend
    env: python
    rootDir: backend
    buildCommand: "./build.sh"
    startCommand: "gunicorn job_board.wsgi:application"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.5
      - key: SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: "False"
      - key: DATABASE_URL
        fromDatabase:
          name: job-board-db
          property: connectionString
      - key: ALLOWED_HOSTS
        value: "*" 
      - key: CORS_ALLOWED_ORIGINS
        value: "http://localhost:5173,http://localhost:8080" # Add production URLs here after deployment
      - key: CSRF_TRUSTED_ORIGINS
        value: "http://localhost:5173,http://localhost:8080" # Add production URLs here after deployment

  - type: static
    name: job-board-admin
    env: static
    rootDir: admin-dashboard
    buildCommand: "npm install && npm run build"
    publishDir: "dist"
    envVars:
      - key: VITE_API_URL
        fromService:
          type: web
          name: job-board-backend
          envVarKey: RENDER_EXTERNAL_URL # Or construct it: https://job-board-backend.onrender.com/api if name is fixed? 
          # Better to use the exposed URL property
          property: url
          # We need to append /api, but Render injects the base URL. 
          # So we might need to handle the /api suffix in the code or here?
          # Render just gives the base URL.
          
    # Note: VITE_API_URL needs to be the backend URL + /api
    # Render's fromService -> property: url gives "https://service-name.onrender.com"
    # We can't easily append string in render.yaml
    # So we should update the code to handle the base URL or expect the user to update it?
    # Actually, in api.ts I used: import.meta.env.VITE_API_URL || '...'
    # If I set VITE_API_URL to the base URL, I need to append /api in the code?
    # Current code: baseURL: API_URL
    # If API_URL is "https://...com", then requests go to "https://...com/auth/..."
    # My backend routes start with /api? 
    # Let's check urls.py.

  - type: static
    name: job-board-user-app
    env: static
    rootDir: my-app
    buildCommand: "npm install && npm run build"
    publishDir: "dist"
    envVars:
      - key: VITE_API_URL
        fromService:
          type: web
          name: job-board-backend
          property: url
